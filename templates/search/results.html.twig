{% extends '@MyDigitalEnvironmentAlerts/search/_base.html.twig' %}
{% trans_default_domain 'my-de-alerts' %}

{% block title %}My Digital Environment | {{ 'alerts.title'|trans }} | {{ 'alerts.title.results'|trans }}{% endblock %}
{% block navTitle %}{{ 'alerts.title.results.long'|trans }} {{ search.description }}{% endblock %}

{% block content %}
    <div class="list-group gap-3">
        {% for document in documents %}

            {% set pColor = 'rgb(0, 0, 0)' %}
            {% if document.platform.value == 'OB' %}
                {% set pColor = 'rgb(183, 50, 136)' %}
            {% elseif document.platform.value == 'OJ' %}
                {% set pColor = 'rgb(11, 183, 217)' %}
            {% elseif document.platform.value == 'CO' %}
                {% set pColor = 'rgb(141, 190, 30)' %}
            {% elseif document.platform.value == 'HO' %}
                {% set pColor = 'rgb(236, 90, 79)' %}
            {% endif %}

            <a class="list-group-item list-group-item-action p-0 border rounded pb-2 shadow"
               href="{{ document.url }}"
               target="_blank">
                <div class="px-2 py-1">
                    {{ _self.platformName(document.platform.value) }}
                    {% if document.site is not null %}
                        <b style="color: {{ pColor }}">/</b>
                        <i>{{ document.site }}</i>
                    {% endif %}
                </div>
                <div class="d-flex flex-row px-2 pt-1 border-top border-3 gap-2"
                     style="border-color: {{ pColor }} !important">
                    <div class="flex-fill d-flex flex-column">
                        <b style="color: {{ pColor }}">{{ document.title }}</b>
                        {% if document.subtitle is not null %}
                            <i>{{ document.subtitle }}</i>
                        {% endif %}
                        {% if document.overview is not null %}
                            <p class="m-0">{{ document.overview }}</p>
                        {% endif %}
                        {% if document.type is not null %}
                            <span style="color: grey">{{ document.type | upper }}</span>
                        {% endif %}
                    </div>
                    <div>
                        {{ _self.authors(document) }}
                    </div>
                </div>
                {# {% if document.overview is not null %} #}
                {#     <br/><span style="color: dimgrey">{{ document.overview }}</span> #}
                {# {% endif %} #}
            </a>
        {% endfor %}
    </div>
    <br/>
    {# {{ dump(result.pagination) }} #}
    {# {{ dump(result.documents) }} #}
    {# {{ dump(result.documents.0) }} #}
{% endblock %}


{% macro authors(document) %}
    {% if document.authors is not null and document.authors is not empty %}
        <div class="d-flex flex-column">
            {% for author in document.authors %}
                <u class="text-nowrap" style="text-align:end;">{{ author }}</u>
                {% if not loop.last %}<br>{% endif %}
            {% endfor %}
        </div>
    {% endif %}
{% endmacro %}

{% macro platformName(platformId) %}
    {% if platformId == 'OB' %}
        {{ 'platform.books'|trans }}
    {% elseif platformId == 'OJ' %}
        {{ 'platform.journals'|trans }}
    {% elseif platformId == 'CO' %}
        {{ 'platform.calenda'|trans }}
    {% elseif platformId == 'HO' %}
        {{ 'platform.hypotheses'|trans }}
    {% endif %}
{% endmacro %}